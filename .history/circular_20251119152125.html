<!DOCTYPE html>
<html lang="en">
<head>
    <center> 
        <img src="images/logo.jpg" style="width: 250px;"> 
    </center>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wijeya Newspapers - Internal Communications</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="../images/logo.jpg" type="image/png">
    <style>
        /* Your existing CSS styles here */
        :root {
            --wijeya-primary: #87CEEB;
            --wijeya-dark: #4682B4;
            --wijeya-light: #E6F2F8;
        }
        body {
            font-family: 'Georgia', serif;
        }
        .navbar {
            background-color: var(--wijeya-primary) !important;
            border-bottom: 3px solid var(--wijeya-dark);
        }
        /* ... rest of your CSS ... */
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                WIJEYA NEWSPAPERS
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.php"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row mb-4">
            <div class="col-md-6">
                <h2>Circulars</h2>
            </div>
        </div>
        
        <!-- Debug Information -->
        <?php
        // Database connection
        $servername = "localhost";
        $username = "root"; // Change to your username
        $password = ""; // Change to your password
        $dbname = "calendar_app";
        
        // Create connection
        $conn = new mysqli($servername, $username, $password, $dbname);
        
        // Check connection
        if ($conn->connect_error) {
            echo '<div class="alert alert-danger">Connection failed: ' . $conn->connect_error . '</div>';
        } else {
            echo '<div class="alert alert-success">Database connected successfully</div>';
            
            // Check if table exists and show columns
            $table_check = $conn->query("SHOW TABLES LIKE 'posts'");
            if ($table_check->num_rows > 0) {
                echo '<div class="alert alert-info">Posts table exists</div>';
                
                // Show table structure
                $columns = $conn->query("SHOW COLUMNS FROM posts");
                echo '<div class="alert alert-warning"><strong>Table Structure:</strong><br>';
                while($col = $columns->fetch_assoc()) {
                    echo $col['Field'] . ' (' . $col['Type'] . ')<br>';
                }
                echo '</div>';
                
                // Try to fetch data
                $sql = "SELECT * FROM posts LIMIT 1";
                $result = $conn->query($sql);
                
                if ($result) {
                    if ($result->num_rows > 0) {
                        echo '<div class="alert alert-success">Data found in posts table</div>';
                        $sample = $result->fetch_assoc();
                        echo '<div class="alert alert-info"><strong>Sample Data:</strong><br>';
                        foreach($sample as $key => $value) {
                            echo $key . ': ' . substr($value, 0, 50) . '<br>';
                        }
                        echo '</div>';
                    } else {
                        echo '<div class="alert alert-warning">No data found in posts table</div>';
                    }
                } else {
                    echo '<div class="alert alert-danger">Query failed: ' . $conn->error . '</div>';
                }
            } else {
                echo '<div class="alert alert-danger">Posts table does not exist</div>';
            }
        }
        ?>
        
        <!-- Search and Date Filter Section -->
        <div class="row mb-4">
            <div class="col-md-8">
                <label class="form-label">Search</label>
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="form-control search-input" placeholder="Search by circular title, content, or number...">
                </div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Date</label>
                <input type="date" class="form-control" placeholder="mm/dd/yyyy">
            </div>
        </div>
        
        <!-- Circulations List - 3x3 Grid -->
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <?php
            if (isset($conn) && !$conn->connect_error) {
                // SQL query to fetch circulars
                $sql = "SELECT * FROM posts ORDER BY publish_date DESC";
                $result = $conn->query($sql);
                
                // Check if there are results
                if ($result && $result->num_rows > 0) {
                    // Output data of each row
                    while($row = $result->fetch_assoc()) {
                        // Use correct column names based on your table structure
                        $featured_image = $row['featured_image'] ?? $row['image'] ?? 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=180&fit=crop&crop=center';
                        $publish_date = $row['publish_date'] ?? $row['date'] ?? date('Y-m-d');
                        $title = $row['title'] ?? $row['name'] ?? 'No Title';
                        $content = $row['content'] ?? $row['description'] ?? 'No content available';
                        $id = $row['id'] ?? 0;
                        
                        // Format the date
                        $formatted_date = date("F j, Y", strtotime($publish_date));
                        
                        // Truncate content for description
                        $description = substr(strip_tags($content), 0, 120);
                        if (strlen(strip_tags($content)) > 120) {
                            $description .= '...';
                        }
                        
                        // Generate a unique ID for the circular
                        $circular_id = "circular_" . $id;
                        
                        echo '
                        <div class="col">
                            <div class="card h-100 circulation-card enhanced-card">
                                <img src="' . htmlspecialchars($featured_image) . '" alt="' . htmlspecialchars($title) . '" class="circular-image">
                                <div class="card-content">
                                    <div class="circular-date">
                                        <i class="fas fa-calendar-alt me-2"></i>
                                        ' . $formatted_date . '
                                    </div>
                                    <h6 class="circular-title">' . htmlspecialchars($title) . '</h6>
                                    <p class="circular-description">
                                        ' . htmlspecialchars($description) . '
                                    </p>
                                    <a href="circular_detail.php?id=' . $id . '" class="btn btn-wijeya">View Details</a>
                                </div>
                            </div>
                        </div>';
                    }
                } else {
                    echo '<div class="col-12"><div class="alert alert-info">No circulars found in the database.</div></div>';
                }
                
                // Close connection
                $conn->close();
            } else {
                echo '<div class="col-12"><div class="alert alert-danger">Cannot connect to database to display circulars.</div></div>';
            }
            ?>
        </div>
       
        <!-- Pagination -->
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#">Next</a>
                </li>
            </ul>
        </nav>
    </div>
    
    <footer class="copyright-footer">
        <div class="container">
            <p>Â© Copyright WNL. All Rights Reserved</p>
        </div>
    </footer>
    
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>